<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>클릭 게임 + 카트늅바보</title>
<style>
  body{font-family:sans-serif;background:#000;color:white;margin:0;padding:0;overflow:hidden;}
  h1{margin-top:20px;position:relative;z-index:10;}
  #money{font-size:24px;margin-bottom:20px;position:relative;z-index:10;}
  #click-btn{font-size:20px;padding:20px 40px;background:#4CAF50;color:white;border:none;border-radius:10px;transition:background .2s;cursor:pointer;position:relative;z-index:10;}
  #click-btn:hover{background:#45a049;}
  .shop{margin-top:20px;display:flex;justify-content:center;gap:20px;position:relative;z-index:10;}
  .item{background:#222;padding:15px;border-radius:10px;box-shadow:0 0 5px rgba(255,255,255,.2);width:200px;text-align:left;}
  .item button{padding:10px;border:none;border-radius:5px;background:#2196F3;color:white;cursor:pointer;margin-top:10px;width:100%;}
  .item button:disabled{background:gray;cursor:not-allowed;}
  canvas{position:fixed;top:0;left:0;z-index:-1;}
</style>
</head>

<body>
<h1>클릭 게임</h1>
<div id="money">돈: 0원</div>
<button id="click-btn">클릭!</button>

<!-- 상점은 JS에서 동적으로 생성됩니다. -->
<div class="shop" id="shop"></div>

<canvas id="kartCanvas"></canvas>

<script>
/* ==================== 1. 게임 상태 ==================== */
let money      = 0;          // 현재 보유 돈
let clickValue = 1;          // 한 번 클릭으로 얻는 금액

/* ==================== 2. 상점 아이템 정의 ==================== */
/* id: 내부 식별자, name: 표시 이름, level/ cost: 상태,
   effect: 구매 시 실행할 함수(레벨이 올라갈 때마다 호출됨) */
const shopItems = [
  {
    id: 'kart',
    name: '카트늅바보',
    level: 0,
    baseCost: 1,
    getCost() { return this.baseCost * Math.pow(2, this.level); },
    effect(level) {
      // 새 카트를 한 개 생성
      createKart();
    }
  },

  {
    id: 'click',
    name: '클릭당 돈 증가',
    level: 0,
    baseCost: 5,
    getCost() { return this.baseCost * Math.pow(2, this.level); },
    effect(level) {
      clickValue = level + 1;          // 레벨이 올라가면 클릭값이 +1
    }
  },

  /* ---------- 신규 아이템 예시 ---------- */
  {
    id: 'auto',
    name: '자동 클릭',
    level: 0,
    baseCost: 10,
    getCost() { return this.baseCost * Math.pow(2, this.level); },
    effect(level) {
      // 첫 번째 구매 시 타이머를 한 번만 세팅
      if (level === 1) {
        setInterval(() => { money += clickValue; updateDisplay(); }, 1000);
      }
    }
  },

  {
    id: 'speed',
    name: '카트 속도 ↑',
    level: 0,
    baseCost: 15,
    getCost() { return this.baseCost * Math.pow(2, this.level); },
    effect(level) {
      // 모든 카트의 dx/dy 를 1.1배씩 증가
      kartList.forEach(k => {
        k.dx *= 1.1;
        k.dy *= 1.1;
      });
    }
  }
];

/* ==================== 3. 상점 UI 렌더링 ==================== */
const shopDiv = document.getElementById('shop');

function renderShop() {
  shopDiv.innerHTML = '';            // 초기화
  shopItems.forEach(item => {
    const el = document.createElement('div');
    el.className = 'item';

    el.innerHTML = `
      <h3>${item.name}</h3>
      <p id="${item.id}-lv">레벨: ${item.level}</p>
      <p id="${item.id}-cost">가격: ${item.getCost()}원</p>
      <button id="buy-${item.id}">구매</button>
    `;

    shopDiv.appendChild(el);

    // 버튼 이벤트 연결
    const btn = document.getElementById(`buy-${item.id}`);
    btn.addEventListener('click', () => {
      if (money >= item.getCost()) {
        money -= item.getCost();
        item.level++;
        item.effect(item.level);   // 레벨이 올라갈 때마다 effect 실행
        updateDisplay();           // UI 갱신
      }
    });
  });
}

/* ==================== 4. 화면 업데이트 함수 ==================== */
function updateDisplay() {
  document.getElementById('money').textContent = `돈: ${money}원`;

  shopItems.forEach(item => {
    const lvEl   = document.getElementById(`${item.id}-lv`);
    const costEl = document.getElementById(`${item.id}-cost`);
    const btn    = document.getElementById(`buy-${item.id}`);

    if (lvEl)   lvEl.textContent   = `레벨: ${item.level}`;
    if (costEl) costEl.textContent = `가격: ${item.getCost()}원`;
    if (btn)    btn.disabled      = money < item.getCost();
  });
}

/* ==================== 5. 카트 움직임 로직 ==================== */
let kartList = [];
const canvas   = document.getElementById('kartCanvas');
const ctx      = canvas.getContext('2d');
let W = window.innerWidth, H = window.innerHeight;
canvas.width = W; canvas.height = H;

window.addEventListener('resize', () => {
  W = window.innerWidth; H = window.innerHeight;
  canvas.width = W; canvas.height = H;
});

function createKart() {
  const speed = Math.random() * 2 + 1;
  kartList.push({
    x: Math.random() * W,
    y: Math.random() * H,
    dx: (Math.random() < .5 ? -1 : 1) * speed,
    dy: (Math.random() < .5 ? -1 : 1) * speed,
    color: randomColor()
  });
}

function randomColor() {
  return `hsl(${Math.random()*360},100%,50%)`;
}

function animate() {
  ctx.clearRect(0,0,W,H);
  ctx.font = "20px Arial";
  ctx.textBaseline = 'top';

  kartList.forEach(kart => {
    kart.x += kart.dx;
    kart.y += kart.dy;

    // 벽에 부딪히면 반전 + 돈 증가
    if (kart.x <= 0 || kart.x + 60 >= W) { kart.dx *= -1; money += shopItems.find(i=>i.id==='kart').level; }
    if (kart.y <= 0 || kart.y + 20 >= H) { kart.dy *= -1; money += shopItems.find(i=>i.id==='kart').level; }

    ctx.fillStyle = randomColor();
    ctx.fillText('카트늅', kart.x, kart.y);
  });

  updateDisplay();          // 매 프레임마다 돈 업데이트
  requestAnimationFrame(animate);
}

/* ==================== 6. 초기 실행 ==================== */
document.getElementById('click-btn').addEventListener('click', () => {
  money += clickValue;
  updateDisplay();
});

renderShop();     // 상점 UI 생성
updateDisplay();  // 한 번만 호출해 초기값 표시
animate();        // 애니메이션 시작
</script>
</body>
</html>
